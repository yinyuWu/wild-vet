import{r as t,h as s,H as a,g as i}from"./p-33b9aa6b.js";import{Logger as e,Hub as n}from"@aws-amplify/core";import{A as r}from"./p-417bb5ea.js";import{appendToCognitoUserAgent as o,Auth as h}from"@aws-amplify/auth";import"./p-26837fd8.js";import{T as c,U as u,A as l,N as p,c as m}from"./p-68e75d13.js";import{d,o as f}from"./p-1d82bb1c.js";import{c as g}from"./p-2f482a8d.js";const y={[r.SignIn]:"sign-in",[r.ConfirmSignIn]:"confirm-sign-in",[r.SignUp]:"sign-up",[r.ConfirmSignUp]:"confirm-sign-up",[r.ForgotPassword]:"forgot-password",[r.ResetPassword]:"require-new-password",[r.VerifyContact]:"verify-contact",[r.TOTPSetup]:"totp-setup",[r.Loading]:"loading"},w=new e("Authenticator"),b=class{constructor(s){t(this,s),this.initialAuthState=r.SignIn,this.handleAuthStateChange=()=>{},this.hideToast=!1,this.authState=r.Loading,this.toastMessage="",this.handleExternalAuthEvent=({payload:t})=>{switch(t.event){case"cognitoHostedUI":case"signIn":g(t.data,d);break;case"cognitoHostedUI_failure":case"parsingUrl_failure":case"signOut":case"customGreetingSignOut":return d(this.initialAuthState)}},this.handleToastEvent=({payload:t})=>{switch(t.event){case c:t.message&&(this.toastMessage=t.message)}}}async componentWillLoad(){f((t,s)=>{this.onAuthStateChange(t,s),this.toastMessage=""}),this.hideToast||n.listen(u,this.handleToastEvent),n.listen(l,this.handleExternalAuthEvent),o("amplify-authenticator"),await this.checkUser()}async checkUser(){if(!h||"function"!=typeof h.currentAuthenticatedUser)throw new Error(p);return h.currentAuthenticatedUser().then(t=>{d(r.SignedIn,t)}).catch(async()=>{let t=null;try{t=localStorage.getItem(m)}catch(s){w.debug("Failed to get the auth state from local storage",s)}try{t===r.SignedIn&&await h.signOut(),d(this.initialAuthState)}catch(s){w.debug("Failed to sign out",s)}})}async onAuthStateChange(t,s){if(void 0===t)return w.error("nextAuthState cannot be undefined");w.info("Inside onAuthStateChange Method current authState:",this.authState),this.authState=t===r.SignedOut?this.initialAuthState:t,this.authData=s,this.authData&&w.log("Auth Data was set:",this.authData),this.authState===t&&(this.handleAuthStateChange(this.authState,this.authData),w.info("authState has been updated to "+this.authState))}getAuthComponent(t){switch(t){case r.SignIn:return s("amplify-sign-in",{federated:this.federated,usernameAlias:this.usernameAlias});case r.ConfirmSignIn:return s("amplify-confirm-sign-in",{user:this.authData});case r.SignUp:return s("amplify-sign-up",{usernameAlias:this.usernameAlias});case r.ConfirmSignUp:return s("amplify-confirm-sign-up",{user:this.authData,usernameAlias:this.usernameAlias});case r.ForgotPassword:return s("amplify-forgot-password",{usernameAlias:this.usernameAlias});case r.ResetPassword:return s("amplify-require-new-password",{user:this.authData});case r.VerifyContact:return s("amplify-verify-contact",{user:this.authData});case r.TOTPSetup:return s("amplify-totp-setup",{user:this.authData});case r.Loading:return s("div",null,"Loading...");default:throw new Error("Unhandled auth state: "+t)}}getSlotWithAuthComponent(t){const a=this.getAuthComponent(t),i=y[t],e=null===this.el.querySelector(`[slot="${i}"]`);return s("slot",{name:i},e&&a)}disconnectedCallback(){return n.remove(l,this.handleExternalAuthEvent),this.hideToast||n.remove(u,this.handleToastEvent),f}render(){return s(a,null,!this.hideToast&&this.toastMessage&&s("amplify-toast",{message:this.toastMessage,handleClose:()=>{this.toastMessage=""},"data-test":"authenticator-error"}),this.authState===r.SignedIn?[s("slot",{name:"greetings"}),s("slot",null)]:s("div",{class:"auth-container"},this.getSlotWithAuthComponent(this.authState)))}get el(){return i(this)}};b.style=":host{--background-color:var(--amplify-background-color);--width:28.75rem;--min-width:20rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;--box-shadow:1px 1px 4px 0 rgba(0, 0, 0, 0.15);--border-radius:6px;--padding:35px 40px;--margin-bottom:20px;--container-height:100vh;--container-display:flex;--container-justify:center;--container-align:center}.auth-container{display:var(--container-display);-ms-flex-pack:var(--container-justify);justify-content:var(--container-justify);-ms-flex-align:var(--container-align);align-items:var(--container-align);min-height:var(--container-height)}";export{b as amplify_authenticator}